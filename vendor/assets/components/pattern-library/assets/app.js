var DS=DS||{};!function(){"use strict";_.templateSettings={evaluate:/\{\{#([\s\S]+?)\}\}/g,interpolate:/\{\{[^#\{]([\s\S]+?)[^\}]\}\}/g,escape:/\{\{\{([\s\S]+?)\}\}\}/g}}();var DS=window.DS||{};!function(a){"use strict";DS.LocationFinder=NEUE.BaseModule.extend({defaultOptions:{url:"/example-data.json",validation:/(^\d{5}$)/},Events:{".js-location-finder-toggle-mode click":"toggleMode",".js-location-finder-submit click":"findLocation",".js-location-finder-form submit":"findLocation",".js-location-finder-reset-form click":"resetForm"},Templates:{searchViewGeo:"#template--locfinder-geo",searchViewZip:"#template--locfinder-zip",resultsView:"#template--locfinder-results",locationResult:"#template--locfinder-location"},_initialize:function(){var b=this;_.bindAll(this,"onModeChange","queryZip","queryGeolocation","geolocationError","printResults"),b.State.reset({mode:"zip",searchTerm:""}),this.Views.$formView=a("<div/>",{className:"locfinder-form"}),this.Views.$resultsView=a("<div/>",{className:"locfinder-results"}),a(document).ready(function(){b.Views.$formView.appendTo(b.$el),b.Views.$resultsView.appendTo(b.$el),b.State.bindEvent("mode","onModeChange"),Modernizr.geolocation?b.State.set("mode","geo"):b.State.set("mode","zip")})},onModeChange:function(){"zip"===this.State.get("mode")?this.Views.$formView.html(this.Templates.searchViewZip):this.Views.$formView.html(this.Templates.searchViewGeo)},toggleMode:function(){"zip"===this.State.get("mode")?this.State.set("mode","geo"):this.State.set("mode","zip")},findLocation:function(){this.initialized&&(this.Views.$formView.find(".js-location-finder-submit").addClass("loading"),"zip"===this.State.get("mode")?this.queryZip():navigator.geolocation.getCurrentPosition(this.queryGeolocation,this.geolocationError))},queryZip:function(){var b=this,c=this.Views.$formView.find("input[name='zip']").val();c.match(this.Options.validation)?(b.State.set("searchTerm",c),a.get(this.Options.url+"?zip="+c).done(function(a){b.printResults(a)}).fail(function(){b.showError("There was a network error. Double-check that you have internet?")})):this.showError("Hmm, make sure you entered a valid zip code.")},queryGeolocation:function(b){var c=this,d=b.coords.latitude,e=b.coords.longitude;this.State.set("searchTerm","your location"),a.get(this.Options.url+"?latitude="+d+"&longitude="+e).done(function(a){c.printResults(a)}).fail(function(){c.showError("There was a network error. Double-check that you have internet?")})},geolocationError:function(a){1===a.code?this.showError("Sorry, it seems like you might have refused to share your location with us. Try using a zip code instead?"):this.showError("We couldn't find your location because of a network error.")},showError:function(a){this.Views.$formView.find(".js-location-finder-submit").removeClass("loading"),this.Views.$resultsView.slideUp(),this.Views.$resultsView.html('<div class="messages error">'+a+"</div>"),this.Views.$resultsView.slideDown()},printResults:function(a){var b=this;this.Views.$resultsView.slideUp(function(){b.Views.$resultsView.html(b.Templates.resultsView({searchTerm:b.State.get("searchTerm")})),_.each(a.results,function(a){b.Views.$resultsView.find(".js-location-finder-results").append(b.Templates.locationResult(a))}),b.Views.$formView.slideUp(),b.Views.$resultsView.slideDown(function(){b.Views.$formView.find(".js-location-finder-submit").removeClass("loading")})})},resetForm:function(){this.Views.$resultsView.slideUp(),this.Views.$formView.slideDown()}})}(jQuery);